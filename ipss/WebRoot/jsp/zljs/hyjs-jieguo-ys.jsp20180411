<!DOCTYPE html>
<html lang="en">
<%@ page import="com.cnipr.cniprgz.entity.WASSectionInfo,com.cnipr.cniprgz.commons.DataAccess,com.cnipr.cniprgz.dao.ChannelDAO,com.cnipr.cniprgz.security.SecurityTools,java.net.URLEncoder" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="n" uri="/WEB-INF/taglib/n.tld"%>
<%@ taglib prefix="st" uri="/WEB-INF/taglib/section.tld"%>
<%@ taglib prefix="tb" uri="/WEB-INF/taglib/tb.tld"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core_rt"%>
<%@ page import="com.cnipr.cniprgz.commons.SetupAccess,com.cnipr.cniprgz.commons.*"%>
<%@ page import="net.jbase.common.util.*"%>

<%@ taglib prefix="s" uri="/struts-tags"%>

<%@ include file="include-head-base.jsp"%>

<meta name="keywords" content="专利检索,专利查询,专利搜索,专利下载" />
<meta name="description" content="<%=website_title%>是-支持专利号查询搜索，Ipc查询专利、实用新型专利和外观专利，支持专利检索，批量下载" />
<meta http-equiv="Cache-Control" content="no-store" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10,IE=11" />

<!--[if lte IE 6]>
<link rel="stylesheet" type="text/css" href="css/bootstrap-ie6.min.css">
<link rel="stylesheet" type="text/css" href="css/ie.css">
<![endif]-->
<%  
    response.setHeader("X-XSS-Protection","0");
    response.setCharacterEncoding("UTF-8");
	
	String area = request.getParameter("area")==null?(String)request.getAttribute("area"):request.getParameter("area");
//System.out.println("area="+area);
	area = (area==null||area.equals(""))?"cn":area;	
	
	String pageCount = (String)request.getAttribute("pageCount");
	
	String indexPage = request.getParameter("indexPage");
	if (indexPage == null || indexPage.equals("")) {
		indexPage = "1";
	}
	String searchKind = (String)request.getAttribute("searchKind");
	String tifServerURL = DataAccess.getProperty("PicServerURL");
	
	String semanSearch=(String)request.getAttribute("strWhere");
	
//System.out.println("strWhere="+semanSearch);
	
	String strWhere = semanSearch;
	String sf=(String)request.getAttribute("simFlag");
	if(semanSearch==null)
		semanSearch ="";
	if(sf!=null&&sf.equals("Y")){
		semanSearch="Y";
	}else if(semanSearch!=null){
		semanSearch=semanSearch.toLowerCase().indexOf("ss")>-1||semanSearch.indexOf("智能检索")>-1||semanSearch.toLowerCase().indexOf("trskeyword/")>-1?"Y":"N";
	}	 
	
	String inChannel = (String)request.getAttribute("filterChannel");
	String strSources =  "";
	if( request.getAttribute("strSources")!=null)
		strSources  = (String) request.getAttribute("strSources");
	
	String strChannel = inChannel;
	if(strChannel==null)
		strChannel = strSources;
	
	if (inChannel == null || inChannel.equals("")) {
		inChannel = (String)request.getAttribute("strChannels");
	} else {
		inChannel = (new ChannelDAO()).getChannelsIDByName(inChannel);
	}	
	
	String strItemGrant = "";
	if(request.getSession().getAttribute("strItemGrant")!=null)
		strItemGrant = (String)request.getSession().getAttribute("strItemGrant");
	//System.out.println("inChannel="+inChannel);
		
	int ABSTBatchCount = (Integer) request.getSession().getAttribute("ABSTBatchCount");
 
String userId = "";
if(request.getSession().getAttribute(Constant.APP_USER_ID)!=null)
{
	userId = ((String)request.getSession().getAttribute(Constant.APP_USER_ID));	
}

int intAnalyseState = 0;
if(request.getSession().getAttribute("intAnalyseState")!=null)
{
	intAnalyseState = ((Integer)request.getSession().getAttribute("intAnalyseState"));	
}
int intAnalyseNumUpperlimit = 0;
if(request.getSession().getAttribute("intAnalyseNumUpperlimit")!=null)
{
	intAnalyseNumUpperlimit = ((Integer)request.getSession().getAttribute("intAnalyseNumUpperlimit"));	
}

//System.out.println("intAnalyseState="+intAnalyseState);
//System.out.println("intAnalyseNumUpperlimit="+intAnalyseNumUpperlimit);
%>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>检索结果-<%=website_title%></title>
<style type="text/css">
#winlogin{
    color: #fff800;
    background-color: #fff800;
    opacity: 0.2;
    cursor:pointer;
}
.ui_dialog_1{
	background-color:#E6E6E6;
}
</style>
</head>

<body>
<!--导航-->


<%@ include file="include-head.jsp"%>
<%@ include file="include-head-nav.jsp"%>

<script src="<%=basePath%>js/hyjs-jieguo.js"></script>

<script language="javascript">
</script>
		
		<script type="text/javascript">
			var area = "<%=area%>";
			var sRoot = "<%=basePath%>";
			var tifServerURL = "<%=tifServerURL%>";
			function nextPage(pageIndex){
//				alert("pageIndex="+pageIndex);
				document.searchForm.action = "<%=basePath%>overviewSearch.do";
				document.searchForm.pageIndex.value = pageIndex;
				$("#searchForm").attr("target", "_self");
				document.searchForm.submit();
			}
			
			function showSearchForm(searchType) {
				document.searchForm.action = "<%=basePath%>search.do?method=showSearchForm";
				document.searchForm.secondOrFilter.value = searchType;
				document.searchForm.submit();
			}
			function changesortmethod(thisObj) {
				var textval = ${requestScope.totalRecord};
//				var strSortMethod = document.getElementById("sortcolumn").value;
//				alert(strSortMethod);				
				var sortMethod = $(thisObj).val();
//				alert(sortMethod);
				
				if(textval<=500000){
					//alert("changepagerecord()........");name="sortcolumn" id="sortcolumn"
					document.searchForm.strSortMethod.value = sortMethod;
					//document.searchForm.pagerecord.value = searchType;
					//alert(document.searchForm.pagerecord.value);				
					document.searchForm.submit();
				}else{
					showexp("命中专利总数超过50万，无法进行排序！");
				}
			}
			function changepagerecord() {				
				//alert("changepagerecord()........");
				document.searchForm.pagerecord.value = document.getElementById("selpagerecord").value;
				//document.searchForm.pagerecord.value = searchType;
				//alert(document.searchForm.pagerecord.value);				
				$("#searchForm").attr("target", "_self");
				document.searchForm.submit();
			}
			function changepagerecord1() {
				//alert("changepagerecord()........");
				document.searchForm.pagerecord.value = document.getElementById("selpagerecord1").value;
				//document.searchForm.pagerecord.value = searchType;
				//alert(document.searchForm.pagerecord.value);				
				document.searchForm.submit();
			}
			
			function quickSearch() {
				document.searchForm.action = "<%=basePath%>overviewSearch.do?method=overviewSearch";
				var keyword=document.getElementById("keyword").value;
				keyword=keyword.replace(/(^\s*)|(\s*$)/g, "");
				if(keyword==""){
					showexp("请输入检索词");
					return false;
				}
				
				var searchword = "(" + keyword + ")" + document.getElementById("ziduan").value;
				var inputWord=keyword;
				var fieldName=document.getElementById("ziduan").value;
				if (area == 'fr' && document.getElementById("secondsearch").checked) {
					document.searchForm.strWhere.value = "(" + document.searchForm.strWhere.value + ") and " + searchword;
				} else if(document.getElementById("secondsearch").checked) {
					//智能检索不需要
					document.getElementById("bContinue").value="1";
					//document.searchForm.strWhere.value = "(" + document.searchForm.strWhere.value + ") and " + searchword;
					  if(fieldName=='ss'){
						 
					  	document.searchForm.strWhere.value = "ss="+inputWord;
					  }else{
					  	document.searchForm.strWhere.value = searchword;
					  }
				} else {
					if(fieldName=='ss'){						
					  	document.searchForm.strWhere.value = "ss="+searchword;
					  }else{
					  	document.searchForm.strWhere.value = searchword;
					  }
				}
				$("#searchForm").attr("target", "_self");
				document.searchForm.submit();
			}
			
			function gotoPage(thisObj) {
				var pageCount = <%=pageCount%>;
				var page = $(thisObj).prev().val();
				/*
				var perpagerecord = document.getElementById("selpagerecord").value;		
				if(page*perpagerecord>5000000){
					showexp("您输入的页码已跳转超过第500万条专利，请重新输入页码！");
					return;
				}
				*/
//alert(pageCount+"----"+page);
				
				var re = /^[1-9]+[0-9]*]*$/;   //判断字符串是否为数字     //判断正整数    
			    if (!re.test(page)) {
//					alert("请输入数字！");
					showexp("请输入1至"+pageCount+"的正确页码！");
					return;
			    }
				if(pageCount>=page){
				    document.searchForm.action = "<%=basePath%>overviewSearch.do";
					document.searchForm.pageIndex.value = page;
					$("#searchForm").attr("target", "_self");
					document.searchForm.submit();
				}else{
					showexp("请输入1至"+pageCount+"的正确页码！");
				}
			}
						
			function getPatentByChannel(channelname,qty){
//				alert("channel="+channel);
//				alert("qty="+qty);
				//alert(document.searchForm.strSources.value);
				if(qty>0){
//					alert("channelname="+channelname);
//					alert("strChannels="+document.searchForm.strSources.value);
				
					document.searchForm.action = "<%=basePath%>overviewSearch.do";
					document.searchForm.filterChannel.value = channelname;	
					document.searchForm.strChannels.value = document.searchForm.strSources.value;
//					document.searchForm.strChannels.value = channelname;
					document.searchForm.pageIndex.value = "1";

					$("#searchForm").attr("target", "_self");
					document.searchForm.submit();
				}else{
//					alert("无此类数据，请重新选择类别");
					showexp("无此类数据，请重新选择类别");
				}
 			}
 			
			function getWords(words){
				var keyWordInput=document.getElementById("keyword");
				keyWordInput.value+=words+" ";
			}
			
			//预警
			function alarm() {
				var exp = document.searchForm.strWhere.value;
				if(exp.indexOf("公开（公告）日")>=0){
//					alert("表达式含有公开公告日，无法进行预警！");
					showexp("表达式含有“公开公告日”，无法进行预警！")
					return ;
				}else{
			    	document.alarmForm.submit();
				}
			}
			  
			// 分析按钮第一次提交后，三分钟内不允许再点击提交
			var alink; 
			function disableLink() 
			{ 
				alink = document.getElementById("piaslink"); 
				//alink.href = "javascript:void(0);"; 
				alink.onclick = function(){return false;}; 
				alink.style.cursor = "text"; 
			} 

			
			var blink; 
			function disableHYZSLink() 
			{ 
				blink = document.getElementById("hyzslink"); 
				//blink.href = "javascript:void(0);"; 
				blink.onclick = function(){return false;}; 
				blink.style.cursor = "text"; 
			} 
			  
			function getDetail(id,dbs){
				var strWhere = "id=" + id + "";
			//params.strWhere=strWhere;	
			//requestExpDataOverview(params,1);

			//alert(strWhere);
			//alert(params.selectdbs);
			//alert(params.language);

				document.showDetail.strWhere.value = strWhere;
				document.showDetail.strSources.value = dbs;
				document.showDetail.area.value = params.language;
				document.showDetail.submit();
			}
			
			function getDetail_(index){
			//alert("index="+index);
			<%
					if(!area.toLowerCase().equalsIgnoreCase("fr"))
					{
			%>
			    		document.showDetail.strWhere.value = document.searchForm.trsLastWhere.value;
			<%}else{%>
						document.showDetail.strWhere.value = document.searchForm.strWhere.value;
		    <%}%>
			      
			      //alert(document.searchForm.strWhere.value);
			      document.showDetail.strWhere.value = document.searchForm.strWhere.value;
			      
				  document.showDetail.strSources.value = document.searchForm.strSources.value;
			      document.showDetail.strChannels.value = document.searchForm.strChannels.value;
			      document.showDetail.strSortMethod.value = document.searchForm.strSortMethod.value;
			      document.showDetail.strDefautCols.value = document.searchForm.strDefautCols.value;
			      
			      
			      document.showDetail.strStat.value = document.searchForm.strStat.value;
			      document.showDetail.iOption.value = document.searchForm.iOption.value;
			      document.showDetail.iHitPointType.value = document.searchForm.iHitPointType.value;
			      document.showDetail.bContinue.value = document.searchForm.bContinue.value;
			      
			      
			      document.showDetail.index.value = index;
			      document.showDetail.filterChannel.value = document.searchForm.filterChannel.value;
			      //是否相似检索
			      if(document.searchForm.simFlag.value=='Y'){
			      	document.showDetail.simFlag.value="Y";
			      	document.showDetail.appNum.value=document.searchForm.appNum.value;
			      	document.showDetail.apdRange.value=document.searchForm.apdRange.value;
			      }
			      document.showDetail.submit();
			}
		</script>
<!-- 		
		<link href="<%=basePath%>css/cnipr.css" rel="stylesheet" type="text/css">
 -->

<%@ include file="include-head-secondsearch-jieguo.jsp"%>

<input type="hidden" id="selectdbs" value="" />
<input type="hidden" id="selectexp" value="<%=strWhere.replace("申请号,公开（公告）号,申请（专利权）人,发明（设计）人,地址,名称,摘要+=", "快速检索=")%>" />

<!--内导航条-->

		<div id="nav_keleyi_com" style="width:1120px;clear:both;margin:auto;">
			<div class="row-fluid">
				<div name="top-navbar" class="navbar navbar-inverse">
		<form id="searchForm1" name="searchForm1" action="" method="post" target="_self">
			<input type="hidden" name="area" id="area" value="<%=area%>">
			<input type="hidden" name="strChannel" id="strChannel">
			<input type="hidden" name="searchKind" value="<%=searchKind%>">
			<input type="hidden" id="strChannels" name="strChannels" value="${requestScope.strChannels }">
			<input type="hidden" name="strSynonymous" value="${requestScope.strSynonymous }">
			<%
			//System.out.print(strWhere);
			//strWhere = URLEncoder.encode(strWhere,"UTF-8");			
			%>
			<input type="hidden" name="strWhere" id="strWhere" value="<%=strWhere%>"/>
			<input type="hidden" name="strSources" value="${requestScope.strSources }">
			<input type="hidden" name="strSortMethod" value="${requestScope.strSortMethod }">
			<input type="hidden" name="strDefautCols" value="${requestScope.strDefautCols }">
			<input type="hidden" name="strStat" value="${requestScope.strStat }">
			<input type="hidden" name="iOption" value="${requestScope.iOption }">
			<input type="hidden" name="iHitPointType" value="${requestScope.iHitPointType }">
			<input type="hidden" id="bContinue" name="bContinue" value="">
			<input type="hidden" name="pageIndex">
			<input type="hidden" name="secondOrFilter">
			<input type="hidden" name="trsLastWhere" id="trsLastWhere" value="${requestScope.trsLastWhere }">
			<input type="hidden" name="filterChannel" value="${requestScope.filterChannel }">
			<!-- 是否相似检索 -->
			<input type="hidden" name="appNum" value="${requestScope.appNum }">
			<input type="hidden" name="simFlag" value="${requestScope.simFlag }">
			<input type="hidden" name="apdRange" value="${requestScope.apdRange }">
		
					<strong>
					<div class="navbar-inner" style=" background-image: none;background-repeat:no-repeat;filter: none;background-color: #999966; border: 0px;border-bottom:0px solid #5cc0cd;">
						<div class="container">
							<div class="nav-collapse collapse">
								<ul class="nav" >
											<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" style="background-image: none;background:none;border: 0px;color:#ffffff;font-weight: normal;">下载 <b class="w_caret"></b> </a>
												<ul class="dropdown-menu">
													<li><a href="javascript:Download();">著录项下载</a></li>
													<%
													//out.println(area);
													
													if(area.equals("cn")){%>
													<!-- 
													<li><a href="javascript:downloadPIC();">全文图形下载</a></li>
													-->
													<li><a href="javascript:downloadPDF();">PDF下载</a></li>
													<%}%>
													<li><a data-toggle="modal" data-target="#downloadBatchModal">著录项批量下载</a></li>													
												</ul>
											</li>



											<%
//											if(SetupAccess.getProperty(SetupConstant.FENXI)!=null && SetupAccess.getProperty(SetupConstant.FENXI).equals("1")){
											%>

											<li><a href="#" style="background-image: none;background:none;border: 0px;color:#ffffff;font-weight: normal;" id="bt_analyse" value="统计分析">统计分析</a></li>
											
											<!-- 
											<%if(SetupAccess.getProperty("translate")!=null && SetupAccess.getProperty("translate").equals("1")){%>
											<li><a href="#" style="background-image: none;background:none;border: 0px;color:#ffffff;font-weight: normal;" id="bt_translate" value="翻译">翻译</a></li>
											<%}%>
											 -->
											
											<% if(SetupAccess.getProperty(SetupConstant.DINGQIYUJING)!=null && SetupAccess.getProperty(SetupConstant.DINGQIYUJING).equals("1")){%>
												 	 <%
												 	 //if(strItemGrant.contains(SetupConstant.DINGQIYUJING))
												 	 if((","+(String)session.getAttribute("userMenu")).indexOf(",7000,")>-1)
												 	 {%>
											<li><a href="#" style="background-image: none;background:none;border: 0px;color:#ffffff;font-weight: normal;" onClick="javascript:alarm();">专利预警</a></li>
													<%}%>
											<%} %>
											
											<%if((","+(String)session.getAttribute("userMenu")).indexOf(",3500,")>-1){%>
											<li><a href="#" style="background-image: none;background:none;border: 0px;color:#ffffff;font-weight: normal;" id="piaslink" onClick="javascript:preSaveFavorite();">放入收藏夹</a></li>
											<%}%>
											
									<li class="active" style="padding-top:10px; color: #ffffff; font-weight: 600; padding-left: 15px;">
										<label class="checkbox" style="width: 30px"><input type="checkbox" value="" onClick="selectAllCheckSort(this.checked)">全选</label>
									</li>
								</ul>
								<ul class="nav pull-right">
									<li>
									
<%
//String _pagerecord = request.getParameter("pagerecord");
//System.out.println("+++++++++++++++++++++++_pagerecord="+_pagerecord);
%>

									
									<s:select name="selpagerecord" list="#{'10':'10','30':'30','50':'50'}" value="#request.pagerecord" onchange="changepagerecord()" theme="simple" cssStyle="width: 50px; padding: 0px; margin: 0px; margin-top:8px; line-height: 25px; height: 25px;"></s:select><!-- value是选中的 -->
								
									
									</li>
<%
String strSortMethod =(String)request.getAttribute("strSortMethod");
%>
									<li>
											


											<select class="input-medium" id="sortcolumn" name="sortcolumn" onChange="changesortmethod(this)" style="width: 112px; padding: 0px; margin: 0px; margin-top:8px; line-height: 25px; height: 25px;">
												<option value="RELEVANCE" <%if(strSortMethod.equals("RELEVANCE")){%>selected="selected"<%}%>>按相似度排序</option>
												<option value="-公开（公告）日" <%if(strSortMethod.equals("-公开（公告）日")){%>selected="selected"<%}%>>按公开日降序</option>
												<!-- 
												<option value="+公开（公告）日" <%if(strSortMethod.equals("+公开（公告）日")){%>selected="selected"<%}%>>按公开日升序</option>
												<option value="+申请日" <%if(strSortMethod.equals("+申请日")){%>selected="selected"<%}%>>按申请日升序</option>
												 -->												
												<option value="-申请日" <%if(strSortMethod.equals("-申请日")){%>selected="selected"<%}%>>按申请日降序</option>												
											</select>
									</li>
									
<li>

<n:nav pageCount="${requestScope.nav.pageCount}"
							pageIndex="${requestScope.nav.pageIndex}"
							navigationUrl="${requestScope.nav.navigationUrl}/overviewSearch.do?method=overviewSearch"
							params="${requestScope.nav.params}"></n:nav>

</li>									
									
								</ul>
							</div>
						</div>
					</div>
					</strong>
					</form>
				</div>
			</div>

		</div>
		
		
		<form name="PatentInfo">
			<input type="hidden" name="strUrl" value="">
			<input type="hidden" name="strAPO" value="">
			<input type="hidden" name="strTI" value="">
			<input type="hidden" name="strIPC" value="">
			<input type="hidden" name="strANN" value="">
			<input type="hidden" name="strPage" value="">
			<input type="hidden" name="strSavePath" value="">
		</form>
		
		<form id="searchForm" name="searchForm"  method="post">
			<input type="hidden" name="area" id="area" value="<%=area%>">
			<input type="hidden" name="strChannel" id="strChannel">
			<input type="hidden" name="searchKind" value="<%=searchKind%>">
			<input type="hidden" id="strChannels" name="strChannels" value="${requestScope.strChannels }">
			<input type="hidden" name="strSynonymous" value="${requestScope.strSynonymous }">			
			<input type="hidden" id="ABSTBatchCount" name="ABSTBatchCount" value="<%=ABSTBatchCount%>">
			
			<input type="hidden" id="simpleSearch" name="simpleSearch" value="">
			<%
			//System.out.print(strWhere);
			//strWhere = URLEncoder.encode(strWhere,"UTF-8");
			%>
			<input type="hidden" name="strWhere" id="strWhere" value="<%=strWhere %>"/>
			<input type="hidden" id="strSources"  name="strSources" value="${requestScope.strSources }">
			<input type="hidden" name="strSortMethod" value="${requestScope.strSortMethod }">
			<input type="hidden" name="strDefautCols" value="${requestScope.strDefautCols }">
			<input type="hidden" name="strStat" value="${requestScope.strStat }">
			<input type="hidden" id="iOption" name="iOption" value="${requestScope.iOption }">
			<input type="hidden" name="iHitPointType" value="${requestScope.iHitPointType }">
			<input type="hidden" id="bContinue" name="bContinue" value="">
			<input type="hidden" name="pageIndex">
			<input type="hidden" name="secondOrFilter">
			<input type="hidden" name="trsLastWhere" id="trsLastWhere" value="${requestScope.trsLastWhere }">
			<input type="hidden" name="filterChannel" value="${requestScope.filterChannel }">
			<!-- 是否相似检索 -->
			<input type="hidden" name="appNum" value="${requestScope.appNum }">
			<input type="hidden" name="simFlag" value="${requestScope.simFlag }">
			<input type="hidden" name="apdRange" value="${requestScope.apdRange }">
			<input type="hidden" name="pagerecord" value="${requestScope.pagerecord }">			
		</form>
		
		<!--  <span id="span1"
			style="position: absolute; left: 156; top: 156; width: 150; height: 118;visibility:visible"><img
				src="<%=basePath%>images/search-a.gif" width=388 height=60 alt=""> </span>-->

<!--内容页面-->	
<div style="width:1120px;clear:both;margin:auto;">
<div class="row-fluid">
<!--span3左-->




<div  class="span3">

<st:section area="<%=area%>" strAllChannels="${requestScope.strSources }" sections="${requestScope.sections}" currentRecord="${requestScope.totalRecord}"
										totalRecord="${requestScope.unfilterTotalCount}" filterChannel="${requestScope.filterChannel }"></st:section>

	     
     </div>
	 <!--span9右-->
	 

		<form id="showDetail" name="showDetail" action="<%=basePath%>detailSearch.do?method=detailSearch" method="post" target="_blank">
			<input type="hidden" name="strWhere">
			<input type="hidden" name="strSources">
			<input type="hidden" name="strChannels">
			<input type="hidden" name="strSortMethod">
			<input type="hidden" name="strDefautCols">
			<input type="hidden" name="strStat">
			<input type="hidden" name="iOption">
			<input type="hidden" name="iHitPointType">
			<input type="hidden" name="bContinue">
			<input type="hidden" name="index">
			<input type="hidden" name="filterChannel">
			<input type="hidden" name="area" value="<%=area%>">
			
			<!-- 是否相似检索 -->
			
			<input type="hidden" name="appNum" value="">
			<input type="hidden" name="simFlag" value="">
			<input type="hidden" name="apdRange" value="">
		

		<tb:row strDisplayColumn="申请（专利）号|120#主分类号|120#名称|500"  patentInfoList="${sessionScope.list}" ctx="<%=basePath%>"></tb:row>
		
		</form>







<!--内导航条-->
		<div id="nav_keleyi_com" style="width:1120px;clear:both;margin:auto;padding-top:10px">
			<div class="row-fluid">
				<div name="top-navbar" class="navbar navbar-inverse">
				
<!-- 				
				action="doOverviewSearch?cid=" 
 -->			
<form method="post"
				name="searchForm2" id="searchForm2">
				<input type="hidden" name="filterItems" id="filterItems"
					value=""> <input type="hidden"
					name="strWhere" value="名称,摘要,申请号,公开（公告）号,分类号,主分类号,发明（设计）人, 申请（专利权）人,专利代理机构,代理人,地址+=(咖啡%)" id="strWhere" /> <input
					type="hidden" name="start" value="1" id="start" /> <input
					type="hidden" name="limit" value="20" id="pageLimit" /> <input
					type="hidden" name="option" value="2"
					id="ioption" /> <input type="hidden" name="strSortMethod"
					value="+TABLE_SN,RELEVANCE" id="strSortMethod" /> <input
					type="hidden" name="channelId" value="FMZL,SYXX,WGZL"
					id="channelId" /> <input type="hidden" name="strSources"
					value="" id="strSources" /> <input
					name="crossLanguage" id="crossLanguage" type="hidden"
					value="" /> <input type="hidden"
					name="strSynonymous" value=""
					id="strSynonymous" /> <input type="hidden" name="filterChannel"
					value="" id="filterChannel" /> <input
					type="hidden" name="key2Save" value=""
					id="key2Save" /> <input type="hidden" name="keyword2Save"
					value="" id="keyword2Save" /> <input
					type="hidden" name="checkSimilar" value="false" />
					</form>
					<strong>
					<div class="navbar-inner" style=" background-image: none;background-repeat:no-repeat;filter: none;background-color: #999999; border: 0px;border-bottom:0px solid #5cc0cd;">
						<div class="container">
							<div class="nav-collapse collapse">
								<ul class="nav" >
											<li class="dropup"><a href="#" class="dropdown-toggle" data-toggle="dropdown" style="background-image: none;background:none;border: 0px;color:#ffffff;font-weight: normal;">下载 <b class="caret" ></b> </a>
												<ul class="dropdown-menu">
													<li><a href="javascript:Download()">著录项下载</a></li>
													
													<%if(area.equals("cn")){%>
													<!-- 
													<li><a href="javascript:downloadPIC();">全文图形下载</a></li>
													 -->
													<li><a href="javascript:downloadPDF();">PDF下载</a></li>
													<%}%>
													
													<li><a data-toggle="modal" data-target="#downloadBatchModal">著录项批量下载</a></li>
												</ul>
											</li>
											
											<!-- 
											<% if(SetupAccess.getProperty(SetupConstant.FENXI)!=null && SetupAccess.getProperty(SetupConstant.FENXI).equals("1")){%>
													    <% if(strItemGrant.contains(SetupConstant.FENXI)){%>
											<li><a href="#" style="background-image: none;background:none;border: 0px;color:#ffffff;font-weight: normal;"  id="piaslink" onClick="javascript:analyse();">专利分析</a></li>
														<%} %>
											<%} %>
											 -->
											<% if(SetupAccess.getProperty(SetupConstant.DINGQIYUJING)!=null && SetupAccess.getProperty(SetupConstant.DINGQIYUJING).equals("1")){%>
												 	 <% if(strItemGrant.contains(SetupConstant.DINGQIYUJING)){%>
											<li><a href="#" style="background-image: none;background:none;border: 0px;color:#ffffff;font-weight: normal;" onClick="javascript:alarm();">专利预警</a></li>
													<%} %>
											<%} %>
											
											<%if((","+(String)session.getAttribute("userMenu")).indexOf(",3500,")>-1){%>
											<li><a href="#" style="background-image: none;background:none;border: 0px;color:#ffffff;font-weight: normal;"  id="piaslink" onClick="javascript:preSaveFavorite();">放入收藏夹</a></li>
											<%}%>
											
									<li class="active" style="padding-top:10px; color: #ffffff; font-weight: 600; padding-left: 15px;">
										<label class="checkbox" style="width: 30px"><input type="checkbox" value="" onClick="selectAllCheckSort(this.checked)">全选</label>
									</li>
								</ul>
								<ul class="nav pull-right">
									<li>
										<s:select name="selpagerecord1" list="#{'10':'10','30':'30','50':'50'}" value="#request.pagerecord" onchange="changepagerecord1()" theme="simple" cssStyle="width: 50px; padding: 0px; margin: 0px; margin-top:8px; line-height: 25px; height: 25px;"></s:select><!-- value是选中的 -->
								
									
									</li>
									
									<li>
											<select class="input-medium" id="sortcolumn1" name="sortcolumn1" onChange="changesortmethod(this)" style="width: 112px; padding: 0px; margin: 0px; margin-top:8px; line-height: 25px; height: 25px;">
												<option value="RELEVANCE" <%if(strSortMethod.equals("RELEVANCE")){%>selected="selected"<%}%>>按相似度排序</option>
												<option value="-公开（公告）日" <%if(strSortMethod.equals("-公开（公告）日")){%>selected="selected"<%}%>>按公开日降序</option>
												<!-- 
												<option value="+公开（公告）日" <%if(strSortMethod.equals("+公开（公告）日")){%>selected="selected"<%}%>>按公开日升序</option>
												<option value="+申请日" <%if(strSortMethod.equals("+申请日")){%>selected="selected"<%}%>>按申请日升序</option>
												 -->												
												<option value="-申请日" <%if(strSortMethod.equals("-申请日")){%>selected="selected"<%}%>>按申请日降序</option>
												
											</select>
									</li>
				<n:nav pageCount="${requestScope.nav.pageCount}"
								pageIndex="${requestScope.nav.pageIndex}"
								navigationUrl="${requestScope.nav.navigationUrl}/overviewSearch.do?method=overviewSearch"
								params="${requestScope.nav.params}"></n:nav>

											
<script>
function preSaveFavorite() {
	var patentList = getPatentList();
	//alert("patentList="+patentList);
	if(patentList == null||patentList=="")
	{
		showexp("请先选择要收藏的记录。");
    	return;
  	}
  	else
	{
		document.download.target="_self";
		$("#favoritepatents").val(patentList);
		
		//alert("patentList="+patentList);
		//alert(str);
		params = {
			favoritepatents : encodeURI(patentList),
			totalPages : 0
		};
		doSaveFavorite(params);
		//document.favoriteForm.action = "<%=basePath%>saveFavorite.do";
		//document.favoriteForm.submit();
	}
}			

function doSaveFavorite(params) {
	//alert(params.favoritepatents);
	var text = "";
	$.ajax({
//	alert("5555");	
		type : "GET",
		url : "<%=basePath%>saveFavorite.do?timeStamp=" + new Date(),
		data : {
			'favoritepatents' : params.favoritepatents,
			'totalPages' : params.totalPages
		},
//		data : $("#loginform").serialize(),
		contentType : "application/json;charset=UTF-8",
		success : function(jsonresult) {
			showexp(jsonresult);
			//$('#myModal').modal('hide');
		}
	});
	
}
</script>

<form id="favoriteForm" name="favoriteForm" >
	<input type="hidden" id="favoritepatents" name="favoritepatents">
</form>		

								</ul>
							</div>
						</div>
					</div>
					</strong>
					
				</div>
			</div>
		</div>

<form name="documentDownload" action="<%=basePath%>documentDownload.do?method=downloadAbstract" method="post" target="_self">
	<input type="hidden" name="strAn">			
</form>
		<form name="download" action="<%=basePath%>documentDownload.do?method=downloadAbstract" method="post" target="_self">
			<br><input type="hidden" name="patentList">
			<input type="hidden" name="downloadcol">
			<input type="hidden" name="downtype">
			<input type="hidden" name="isbatchdownload">
			<input type="hidden" name="downloadStart">
			<input type="hidden" name="downloadAmount">			
			
			<input type="hidden" name="area" id="area" value="<%=area%>">
			<input type="hidden" name="strChannel" id="strChannel">
			<input type="hidden" name="searchKind" value="${requestScope.searchKind }">
			<input type="hidden" name="strChannels" value="${requestScope.strChannels }">
			<input type="hidden" name="strSynonymous" value="${requestScope.strSynonymous }">
			<input type="hidden" name="strWhere" id="strWhere" value="${requestScope.strWhere }">
			<input type="hidden" name="strSources" value="${requestScope.strSources }">
			<input type="hidden" name="strSortMethod" value="${requestScope.strSortMethod }">
			<input type="hidden" name="strDefautCols" value="${requestScope.strDefautCols }">
			<input type="hidden" name="strStat" value="${requestScope.strStat }">
			<input type="hidden" name="iOption" value="${requestScope.iOption }">
			<input type="hidden" name="iHitPointType" value="${requestScope.iHitPointType }">
			<input type="hidden" id="bContinue" name="bContinue" value="">
			<input type="hidden" name="pageIndex">
			<input type="hidden" name="secondOrFilter">
			<input type="hidden" name="trsLastWhere" id="trsLastWhere" value="${requestScope.trsLastWhere }">
			<input type="hidden" name="filterChannel" value="${requestScope.filterChannel }">
			<!-- 是否相似检索 -->
			<input type="hidden" name="appNum" value="${requestScope.appNum }">
			<input type="hidden" name="simFlag" value="${requestScope.simFlag }">
			<input type="hidden" name="apdRange" value="${requestScope.apdRange }">			
		</form>
		

<%@ include file="include-buttom.jsp"%>


<script>
function Download() {
//	alert(area);
	
	var patentList = getPatentList();
//alert("patentList="+patentList);
//return;
	if(patentList == null||patentList=="")
	{
		showexp("请先选择要下载文摘的记录。");
    	return;
  	}
  	else
	{
  		if(area==='cn'){
  			$('#downloadModal').modal('show');
  		}else{
  			$('#frdownloadModal').modal('show');
  		}
	}
}

function beginDownload() {
	var patentList = getPatentList();
	var checkedItems = "";
	
	if(area==='cn'){
		$("#downloadTableInfo input[name='downloadColumn']").each(
				function() {
//					alert($(this).attr("checked"));
					if ($(this).attr("checked")=='checked') {
						checkedItems += $(this).val() + ",";
					}
		});
	}else{
		$("#frdownloadTableInfo input[name='downloadColumn']").each(
				function() {
//					alert($(this).attr("checked"));
					if ($(this).attr("checked")=='checked') {
						checkedItems += $(this).val() + ",";
					}
		});
	}
			
//alert(checkedItems);
//return;
	
	if (checkedItems != "") {
		checkedItems = checkedItems.substring(0, checkedItems.length - 1);
//alert(checkedItems);

		var where = "";
		var arrAn = patentList.split(',');
		for (var i=0;i<arrAn.length;i++)
		{
//			document.write(cars[i] + "<br>");
			where += "申请号="+arrAn[i] + " or ";
		}
		if(where!=""&&where.lastIndexOf(" or ")>0){
			where=where.substring(0,where.lastIndexOf(" or "));
//			where = "(" + where + ")";
		}
//alert(where);
		
		var source = "";
		
	    if(document.searchForm.filterChannel.value!=''){
	    	source = document.searchForm.filterChannel.value;
	    }else{
	    	source = document.searchForm.strSources.value;
	    }		
		
		var strSortMethod=document.searchForm.strSortMethod.value;
//		var option=document.searchForm.option.value;

		var iHitPointType=document.searchForm.iHitPointType.value;
		var filterChannel=document.searchForm.filterChannel.value;
		var strSynonymous=document.searchForm.strSynonymous.value;		

$("body").mask("正在生成下载文件，请稍候...");
//alert("555");

	$.ajax({
//		url : ctx + '/downloadTIFFZip.do',
		url : '<%=basePath%>createAbstractZip.do',
		type : 'POST',
		data : {
//			'area' : '<%=area%>',
//			'strWhere' : where,
			'strSources' : source,
			'downtype' : 0,
			'downloadcol' :  checkedItems,
//			'strSortMethod' : strSortMethod,
//			'iHitPointType' : iHitPointType,
//			'filterChannel' : filterChannel,
//			'strSynonymous' : strSynonymous,
			'isbatchdownload' : 0,
			'patentList' : patentList
//			'downloadStart' : downloadStart,
//			'downloadAmount' : downloadAmount
		},
		success : function(jsonresult) {
			$("body").unmask();
//			alert(jsonresult);

			$.dialog({
				id : 'winlogin',
				bgcolor : '#FFF',				
				title : '下载',
				max : false,
				min : false,
				content : '<div style="line-height:22px;">资源获取成功，<a href='
					+ '<%=basePath%>downloadZipfile.do?fileName=' + jsonresult
					+ '>[这里]</a>进行下载 !</div>'
			});

		},
		error : function() {
			$("body").unmask();
			//alert(json.rmsg);
		}
	});

	}else{
		$.dialog({
			title : '温馨提示',
			content : '请选择下载的字段',
			lock : true,
//			icon : 'face-sad.png',
			max : false,
			min : false,
			cancel : true,
			cancelVal : '关闭'
		});
	}
}

function batchDownload() {
	$('#downloadBatchModal').modal('show');
}
var params = {};
var downloadCount = $("#ABSTBatchCount").val(); 
//	$("#ABSTBatchCount").val();
if(downloadCount<=500){
	downloadCount=500;
}
if(downloadCount>5000){
	downloadCount=5000;
}
//alert("downloadCount="+downloadCount);

function _download2000(){
//	$(".dropmenu").unbind("click");
//	$(".dropmenu").hide();
//	$(".dropmenu").show();

	var begin=$("#_begin").val();
	var end=$("#_end").val();
	
//	var downloadenab=$("#downloadenab").attr("checked");
	var r = /^\+?[1-9][0-9]*$/;
	if(!r.test(begin)||!r.test(end)){
		showexp("输入件数错误，请重新输入！");
		return false;
	}else if(begin <= 0 || end <= 0){
		showexp("请输入大于0的数字！");
		return false;
	}else if((end-begin)<0){
		showexp("结束标记应大于开始标记！");
		return false;
	}else if((end-begin)>downloadCount){
		showexp("您所在的权限组，每次下载仅限 "+downloadCount+" 件专利著录项！");
		return false;
	}else{
		var checkedItems = "";
		
		if(area==='cn'){
			$("#downloadBatchTableInfo input[name='downloadColumn']").each(
					function() {
						if ($(this).attr("checked")=='checked') {
							checkedItems += $(this).val() + ",";
						}
					});
		}else{
			$("#frdownloadBatchTableInfo input[name='downloadColumn']").each(
					function() {
						if ($(this).attr("checked")=='checked') {
							checkedItems += $(this).val() + ",";
						}
			});
		}
		
		
		if (checkedItems != "") {
			checkedItems = checkedItems.substring(0, checkedItems.length - 1);
//alert(checkedItems);
			var where =document.searchForm.strWhere.value;
			var source = document.searchForm.strSources.value;
			var strSortMethod=document.searchForm.strSortMethod.value;
//			var option=document.searchForm.option.value;

			var iHitPointType=document.searchForm.iHitPointType.value;
			var filterChannel=document.searchForm.filterChannel.value;
			var strSynonymous=document.searchForm.strSynonymous.value;
			
			var downloadStart = begin;
			var downloadAmount = (end-begin)+1;

$("body").mask("正在生成下载文件，请稍候...");
//alert("555");
			
/*
			document.download.downloadStart.value = begin;
			document.download.downloadAmount.value = (end-begin)+1;
			var isbatchdownload = 1;
		    document.download.isbatchdownload.value = isbatchdownload;
			var strDownFileType = 0;
			document.download.downtype.value = strDownFileType;		
//			document.download.downloadcol.value = "申请（专利）号,名称,主分类号,分类号,申请（专利权）人,发明（设计）人,公开（公告）日,公开（公告）号,专利代理机构,代理人,申请日,地址,摘要,国省代码";

			document.download.downloadcol.value = checkedItems;
			document.download.action = "<%=basePath%>downloadAbstract.do";
			document.download.submit();	
*/

//$("#downloadBatchModal").modal("hide");
/*
alert("1111");
alert(where);
alert(source);
alert(strSortMethod);
alert(iHitPointType);
alert(filterChannel);
alert(strSynonymous);
alert(downloadStart);
alert(downloadAmount);
*/


		$.ajax({
//			url : ctx + '/downloadTIFFZip.do',
			url : '<%=basePath%>createAbstractZip.do',
			type : 'POST',
			data : {
				'area' : '<%=area%>',
				'strWhere' : where,
				'strSources' : source,
				'downtype' : 0,
				'downloadcol' :  checkedItems,
				'strSortMethod' : strSortMethod,
				'iHitPointType' : iHitPointType,
				'filterChannel' : filterChannel,
				'strSynonymous' : strSynonymous,
				'isbatchdownload' : 1,
				'downloadStart' : downloadStart,
				'downloadAmount' : downloadAmount
			},
			success : function(jsonresult) {
				$("body").unmask();
//				alert(jsonresult);

				$.dialog({
					id : 'winlogin',
					bgcolor : '#FFF',				
					title : '下载',
					max : false,
					min : false,
					content : '<div style="line-height:22px;">资源获取成功，<a href='
						+ '<%=basePath%>downloadZipfile.do?fileName=' + jsonresult
						+ '>[这里]</a>进行下载 !</div>'
				});

			},
			error : function() {
				$("body").unmask();
				//alert(json.rmsg);
			}
		});


/*
			$.post("<%=basePath%>createAbstractZip.do?rd=" + Math.random(), {
				strWhere : where,
				source : source,
				strSortMethod : strSortMethod,
//				option : option,
				iHitPointType : iHitPointType,
				filterChannel : filterChannel,
				strSynonymous : strSynonymous,
	//			begin : begin,
	//			end:end
				downloadStart:downloadStart,
				downloadAmount:downloadAmount
				//downloadenab:downloadenab
			}, function(json) {
				$("body").unmask();
				if (json.success) {
					var html =
						"<div style='line-height:22px;'>资源获取成功，请点击<a href='"
						+ json.downloadbean.fileURLPath
						+ "' target='_blank'>[这里]</a>进行下载 !</div>"
					$.dialog({
						title:'下载',
						max:false,
						min:false,
						lock: true,
						content: html
					});
					return true;
				} else {					
					if (json.cnipr_ajax_status_code == ajaxLogin) {
						showexp(json.msg);
						// 后续处理
					} else if (json.cnipr_ajax_status_code == ajaxDeny) {
						showexp(json.msg);
						// 后续处理
					} else {
						alert(json.msg);
						// 后续处理
					}					
					return false;
				}
			});
*/
		}else{
			showexp("请选择下载的字段");
		}
	}	
}
</script>

<%@ include file="include-downloadmodal.jsp"%>
</BODY>
	
</HTML>

<%
String _action = "";
//0:tif;1:png
String showPIC = DataAccess.get("showPIC")==null?"1":DataAccess.get("showPIC");
/*
if(showPIC.equals("1")){
	_action = "createPNGZip.do";
}else{
	_action = "createTIFFZip.do";
}*/
_action = "createPDFZip.do";
%>

<!-- 
<script type="text/javascript" src="<%=basePath%>common/com_2/js/common.js"></script>
 -->
<!-- 
<script type="text/javascript" src="<%=basePath%>js/hyjs-jieguo.js"></script>
 -->
<script type="text/javascript">
function _nochecked()
{
	var _An = "";
	var checkednum = 0;
    for (var i=0;i<document.showDetail.elements.length;i++)
    {
        var e = document.showDetail.elements[i];        
//      var s=document.getElementById("a").attributes.getNamedItem("name").nodeValue;        
        if (e.name == 'patent' && e.checked)
        {
    	   checkednum++;
    	   _An += e.attributes.getNamedItem("an").nodeValue+",";
    	}
    }
    
    //alert(_An);
	return _An;
}

function getPatentList(){
	//$("input[name='patent']")
	var str = "";
	$("input[name='patent']:checked").each(function(){
		$(this).attr("an");//删除集合元素
		//alert($(this).attr("an"));//$(".myradio:checked").hide(); 
		str+=$(this).attr("an")+",";
	});
	if(str!=""){
		str=str.substr(0,str.length-1);
	}
	return str;
}

function selectAllCheckSort(objValue) {
		if (objValue == true) {
			$("input[name='patent']:checkbox").each(function(i) {
//				alert($(this).val());
//				$(this).attr("checked",true);
//				$(this).checked = true;
				this.checked=true;
			});		
		} else {
			$("input[name='patent']:checkbox").each(function(i) {
//				alert($(this).val());
//				$(this).attr("checked",false);
//				$(this).checked = false;
				this.checked=false;
			});	
		}
}

function downloadPIC() {
	//alert(ctx);	
	var tifInfos = "";
/*
		$("input[name='patent']").each(function(i) {
			if ($(this).attr("checked")) {
	//alert($(this).val());			
				tifInfos += $(this).attr("tifvalue") + ";";
			}
		});
*/
		$("input[name='patent']:checked").each(function(){
			$(this).attr("an");//删除集合元素
			//alert($(this).attr("an"));//$(".myradio:checked").hide(); 
			tifInfos+=$(this).attr("tifvalue")+";";
		});
		
		if (tifInfos == "") {
			showexp("请勾选您需要下载的专利后点击下载。");
			return;
		}
$("body").mask("正在生成下载文件，请稍候...");
		
		$.ajax({

			url : '<%=basePath%><%=_action%>',			
			
			type : 'POST',
			data : {
				'tifInfos' : tifInfos
			},
			success : function(jsonresult) {
$("body").unmask();
				//alert(jsonresult);

				$.dialog({
					id : "winlogin",
					bgcolor : "#FFF",				
					title : '下载',
					max : false,
					min : false,
					content : "<div style='line-height:22px;'>资源获取成功，<a href="
						+ "<%=basePath%>downloadZipfile.do?fileName=" + jsonresult
						+ ">[这里]</a>进行下载 !</div>"
				});
			},
			error : function() {
				//$("body").unmask();
				//alert(json.rmsg);
			}
		});		
	}
	
function downloadPDF() {
	//alert(ctx);	
	var tifInfos = "";
/*
		$("input[name='patent']").each(function(i) {
			if ($(this).attr("checked")) {
	//alert($(this).val());			
				tifInfos += $(this).attr("tifvalue") + ";";
			}
		});
*/
		$("input[name='patent']:checked").each(function(){
			$(this).attr("an");//删除集合元素
			//alert($(this).attr("an"));//$(".myradio:checked").hide(); 
			tifInfos+=$(this).attr("tifvalue")+";";
		});
		
		if (tifInfos == "") {
			showexp("请勾选您需要下载的专利后点击下载。");
			return;
		}
$("body").mask("正在生成下载文件，请稍候...");
		
		$.ajax({
			url : '<%=basePath%><%=_action%>',
			
			type : 'POST',
			data : {
				'tifInfos' : tifInfos,
				'pictype' : <%=showPIC%>
			},
			success : function(jsonresult) {
$("body").unmask();
				//alert(jsonresult);

				$.dialog({
					id : "winlogin",
					bgcolor : "#FFF",				
					title : '下载',
					max : false,
					min : false,
					content : "<div style='line-height:22px;'>资源获取成功，<a href="
						+ "<%=basePath%>downloadZipfile.do?fileName=" + jsonresult
						+ ">[这里]</a>进行下载 !</div>"
				});
			},
			error : function() {
				//$("body").unmask();
				//alert(json.rmsg);
			}
		});		
	}
//-->
</script>
<script type="text/javascript">
var currentPage = '1';
	
$(function() {
	$('#pageEnterBtn1').bind('keydown', function(event) {
		var event = arguments.callee.caller.arguments[0] || window.event;//消除浏览器差异  
		if (event.keyCode == 13) {
//			goEnterPage();
//			
			var pagenum=$("#pageEnterBtn").val();
			var re = /^[1-9]+[0-9]*]*$/;   //判断字符串是否为数字     //判断正整数    
		    if (!re.test(pagenum)) {
				alert("请输入数字！");
				return;
		    }
//			alert(pagenum);
			nextPage(pagenum);
		}
	});
});
	

function analyse1() {
    var textval = ${requestScope.totalRecord};			    
    //alert(textval);
    //分析数量限制为10万 
    if (textval > 100000) {
    	showexp("分析数据超过上限100000条专利，请缩小分析范围，重新进行分析。");
    } else {
      disableLink();
      setTimeout("enableLink()", 180000);
      document.piasform.submit();
    }
}

$("#bt_analyse1").click(function (){
	$("#searchForm").attr("action", "<%=basePath%>analyse.do");
	$("#searchForm").attr("method", "post");
	$("#searchForm").attr("target", "_blank");
	$("#searchForm").submit();
});

$("#bt_analyse").click(function (){
	if(<%=intAnalyseState%>==0){
		showexp("您没有分析权限");
	}else{
		var intAnalyseNumUpperlimit = <%=intAnalyseNumUpperlimit%>;
//alert(intAnalyseNumUpperlimit);
		var _totalRecord = ${requestScope.totalRecord};
//alert(_totalRecord);	
		if(_totalRecord>intAnalyseNumUpperlimit){
			showexp("分析数据超过上限"+intAnalyseNumUpperlimit+"条专利，请缩小分析范围，重新进行分析。");
		}else{
			newWinUrl("<%=basePath%>analyse.do?language=<%=area%>");
		}
	}
});

function translate0(index) {
	var checkedItems = "ti_"+index + ":" + $("#ti_"+index).attr("an");	
//	alert(checkedItems);
	
	if(checkedItems==""){
		showexp("请您选择要翻译的专利");
	}else{
		$("body").mask("正在翻译，请稍候...");
			$.ajax({
				type : "GET",
				url : "mutitranslate.do?timeStamp=" + new Date(),				
				data : {
					'ans' : checkedItems
				},
				contentType : "application/json;charset=UTF-8",
				success : function(jsonresult) {
//alert(jsonresult);
					var arr = jsonresult.split("===");
//					alert(arr.length);
					for(var i = 0;i < arr.length; i++){
//						alert(arr[i]);
						var _arr = arr[i].split("\\n");
//						alert(_arr.length);
//alert("#ti_en_"+_arr[0]);
						$("#ti_en_"+_arr[0]).html("译文:"+_arr[1]);
						if(_arr.length==3){
							$("#ab_en_"+_arr[0]).html("译文:\r\n"+_arr[2]);
						}
					}
					
//					if(itemnum==0)
					{
						$("body").unmask();
					}
				}
			})
	}
}

$("#bt_translate").click(function (){
	
	var checkedItems = "";
	$("input[name='patent']").each(
		function() {
//			alert($(this).attr("checked"));
			if ($(this).attr("checked")=='checked') {
//				checkedItems += $(this).attr("id") + ",";					
				if(checkedItems!=""){
					checkedItems += ",";
				}
				checkedItems += $(this).attr("id") + ":" + $(this).attr("an");
			}
	});
//	alert(checkedItems);
	var itemnum = checkedItems.split(",").length;
//	alert("--->"+itemnum);
	
	if(checkedItems==""){
		showexp("请您选择要翻译的专利");
	}else{
		$("body").mask("正在翻译，请稍候...");
//			alert(ipc);
//			alert(ti);
//			alert(ab);
			
			$.ajax({
				type : "GET",
//					url : "/" + contextPath + "/expdeleteExp.do?timeStamp=" + new Date(),
				url : "mutitranslate.do?timeStamp=" + new Date(),
				
				data : {
					'ans' : checkedItems
				},
				contentType : "application/json;charset=UTF-8",
				success : function(jsonresult) {
//					alert(jsonresult);
					var arr = jsonresult.split("===");
					
					for(var i = 0;i < arr.length; i++){
//						alert(arr[i]);
						var _arr = arr[i].split("\\n");
						$("#ti_en_"+_arr[0]).html("译文:"+_arr[1]);
						$("#ab_en_"+_arr[0]).html("译文:\r\n"+_arr[2]);
						
						itemnum--;
//						alert("itemnum="+itemnum);
					}
					
//					alert("itemnum="+itemnum);
//					var _arr = jsonresult.split("\\n");
					
//					$("#ti_en_"+no).html("译文:"+_arr[0]);
//					$("#ab_en_"+no).html("译文:\r\n"+_arr[1]);
					if(itemnum==0){
						$("body").unmask();
					}
				}
			})
	}
	
});
//String exp = request.getParameter("strWhere");
//String dbs = request.getParameter("strSources");

//伪装一下表单提交在新窗口
function newWinUrl(url){
//alert(url);
//var ran = ""+Math.random();
//ran = ran.substr(2,6);
//alert(xxx);

    var f=document.createElement("form");
//    f.id="f"+ran;
//    f.name="f"+ran;
    
    var exp =document.createElement("input");
    exp.id = "strWhere";
    exp.name = "strWhere";
    exp.type = "hidden";
    exp.value = document.searchForm.strWhere.value;
    
    var dbs =document.createElement("input");
    dbs.id = "strSources";
    dbs.name = "strSources";
    dbs.type = "hidden";
        
    if(document.searchForm.filterChannel.value!=''){
    	dbs.value = document.searchForm.filterChannel.value;
    }else{
    	dbs.value = document.searchForm.strSources.value;
    }
    
 //alert(dbs.value);
    
    f.appendChild(exp);
    f.appendChild(dbs);
        
//    alert(dbs.value);

//    f.setAttribute("id" , "f"+ran);
//    f.setAttribute("name" , "f"+ran);
    f.setAttribute("action" , url);
    f.setAttribute("method" , 'post' );
    f.setAttribute("target" , '_black' );
    document.body.appendChild(f);
    
    f.submit();
}
</script>

