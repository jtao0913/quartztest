<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html; charset=GBK">
<style type="text/css">
<!--
body {
	margin-left: 0px;
	margin-top: 0px;
	margin-right: 0px;
	margin-bottom: 0px;
}
select.menudefine
{
	color: #000000;
	background-color: #ffffff;
	font-size: 12px;
	border-right: appworkspace 1px solid;
	border-top: appworkspace 1px solid;
	border-left: appworkspace 1px solid;
	border-bottom: appworkspace 1px solid;
	font-family: Verdana, 宋体;
	margin-left: 1px;
	margin-right: 1px;
	padding-top: 1px;
	padding-bottom: 1px;
}
.style4 {font-size: 13px}
-->
</style>

<script language="JavaScript" type="text/JavaScript">
<!--
var rwin = null;
var g_fIsSP2 = false;
function browserVersion()
{
   g_fIsSP2 = (window.navigator.userAgent.indexOf("SV1") != -1);
/*
   if (g_fIsSP2)
   {
   //This browser is Internet Explorer in SP2. 
   }
   else
   {
   //This browser is not Internet Explorer in SP2.
   }
*/
}

function CheckButtonStatus()
{
	if(document.all.txtCurrentPage.value == null || document.all.txtCurrentPage.value == "")
		document.all.txtCurrentPage.value = "1";
	
	if(parseInt(document.all.txtCurrentPage.value) <= 1)
	{	
		document.all.btnPrev.disabled = true;
	}
	else{
		document.all.btnPrev.disabled = false;
	}
	if(parseInt(document.all.txtCurrentPage.value) >= parseInt(document.PatentInfo.strPage.value))
	{	
		document.all.btnNext.disabled = true;
	}
	else{
		document.all.btnNext.disabled = false;
	}
	//alert(document.all.txtCurrentPage.value);
	//alert(document.PatentInfo.strPage.value);
		
	document.all.lbCurrentPage.innerText = document.all.txtCurrentPage.value;
	//window.parent.mainFrame.leftFrame.highlightTable(document.all.txtCurrentPage.value);
}

function leftStatusChange1(){
	var tifno=document.all.txtCurrentPage.value;
	//alert(document.all.txtCurrentPage.value);
	var leftFrameLocation=window.parent.mainFrame.leftFrame.location;
	leftFrameLocation+="";
	if(leftFrameLocation.indexOf("#a")>-1){
		leftFrameLocation=leftFrameLocation.substring(0,leftFrameLocation.indexOf("#a"));
	}
	//window.parent.mainFrame.leftFrame.document.TurnPage.destThumbNailImage.value=tifno;
	window.parent.mainFrame.leftFrame.highlightTable(window.parent.mainFrame.leftFrame.document,tifno);
//alert(leftFrameLocation+"#a"+tifno);
	window.parent.mainFrame.leftFrame.location=leftFrameLocation+"#a"+tifno;
}

function leftStatusChange(){
try{
	var tifno=document.all.txtCurrentPage.value;
//alert(tifno);
	var leftPageIndex=window.parent.mainFrame.leftFrame.TurnPage.pageIndex.value;
	var leftPageFirst = (leftPageIndex-1)*5+1;
	var leftPageLast = leftPageIndex*5;
	
	//alert(pageno/5);
	//alert(pageno%5);
	
	//alert(parseInt(pageno/5));
	var leftPageNo=1;
	if(tifno/5==parseInt(tifno/5)){
		leftPageNo=tifno/5;
	}else{
		leftPageNo=parseInt(tifno/5)+1;
	}
	
	if(tifno>leftPageLast || tifno<leftPageFirst){
		window.parent.mainFrame.leftFrame.document.TurnPage.destThumbNailImage.value=tifno;
		window.parent.mainFrame.leftFrame.turnpage(window.parent.mainFrame.leftFrame.document,leftPageNo);
	}else{
		var leftFrameLocation=window.parent.mainFrame.leftFrame.location;
		leftFrameLocation+="";
		//alert(leftFrameLocation.indexOf("table"));
		if(leftFrameLocation.indexOf("#a")>-1){
			leftFrameLocation=leftFrameLocation.substring(0,leftFrameLocation.indexOf("#a"));
		}
		if(leftFrameLocation.indexOf("#top")>-1){
			leftFrameLocation=leftFrameLocation.substring(0,leftFrameLocation.indexOf("#top"));
		}
		
		window.parent.mainFrame.leftFrame.document.TurnPage.destThumbNailImage.value=tifno;
		window.parent.mainFrame.leftFrame.highlightTable(window.parent.mainFrame.leftFrame.document,tifno);
		window.parent.mainFrame.leftFrame.location=leftFrameLocation+"#a"+document.all.txtCurrentPage.value;
	}
	
}catch(e){
	alert(e.name+":"+e.message);
}

}

function Zoom(rate)
{
	if(rate <= 0)
		return;
	window.parent.mainFrame.rightFrame.document.all.PatTifAcTiveX1.SetImageScale(rate);
}

function Rotary(str)
{
	window.parent.mainFrame.rightFrame.document.all.PatTifAcTiveX1.CtrRotary();
}

function MoveTo()
{
	if(document.all.txtCurrentPage.value == null || document.all.txtCurrentPage.value == "")
		document.all.txtCurrentPage.value = "1";
	else
	{
		if(parseInt(document.all.txtCurrentPage.value) > parseInt(document.PatentInfo.strPage.value) || parseInt(document.all.txtCurrentPage.value) < 1)
			document.all.txtCurrentPage.value = "1";
	}
	
	var tmpPage = document.all.txtCurrentPage.value;
	var tmpUrl = CreateUrl(tmpPage);
	window.status="正在接收数据...";
	SetReadUrl(tmpUrl, document.PatentInfo.strAPO.value);
	CheckButtonStatus();
	leftStatusChange();
}

function nextpage()
{
	if(document.all.txtCurrentPage.value == null || document.all.txtCurrentPage.value == "")
		document.all.txtCurrentPage.value = "1";
	else
	{
		if(parseInt(document.all.txtCurrentPage.value) < parseInt(document.PatentInfo.strPage.value))
			document.all.txtCurrentPage.value = parseInt(document.all.txtCurrentPage.value)+1;
		else
			return;
	}
	
	var tmpPage = document.all.txtCurrentPage.value;
	var tmpUrl = CreateUrl(tmpPage);
	//alert("nextpage");
	CheckButtonStatus();
	leftStatusChange();
	//document.all.btnNext.disabled = true;
	window.status="正在接收数据...";
	
	SetReadUrl(tmpUrl, document.PatentInfo.strAPO.value);
}

function prevpage()
{
	if(document.all.txtCurrentPage.value == null || document.all.txtCurrentPage.value == "")
		document.all.txtCurrentPage.value = "1";
	else
	{
		if(parseInt(document.all.txtCurrentPage.value) > 1)
			document.all.txtCurrentPage.value = parseInt(document.all.txtCurrentPage.value)-1;
		else
			return;
	}
	//alert("prevpage");
	CheckButtonStatus();
	leftStatusChange();
	//document.all.btnPrev.disabled = true;
	
	var tmpPage = document.all.txtCurrentPage.value;
	var tmpUrl = CreateUrl(tmpPage);
	window.status="正在接收数据...";
	SetReadUrl(tmpUrl, document.PatentInfo.strAPO.value);
}

function SetReadUrl(strUrl, strAPO)
{
	window.parent.mainFrame.rightFrame.document.all.PatTifAcTiveX1.SetNetTifPath(strUrl,'aaaaa', strAPO);
	window.parent.mainFrame.rightFrame.document.body.scrollTop=0;
}

function Refresh()
{
	window.parent.mainFrame.rightFrame.document.all.PatTifAcTiveX1.CtrFrash();
}

function CreateUrl(str)
{
	var sUrl = document.PatentInfo.strUrl.value;
	var sPage = str;
	
	sUrl = sUrl.substring(0,sUrl.lastIndexOf('/')+1);

	for(var i=0;i<(6-sPage.length);i++)
	{
		sUrl = sUrl + "0";
	}
	sUrl = sUrl + str + ".tif";
	document.PatentInfo.strUrl.value = sUrl;
	return sUrl;
}

function Print()
{	
	var m_strUrl = document.PatentInfo.strUrl.value;
	var m_strAPO = document.PatentInfo.strAPO.value;
	var m_strPage = document.PatentInfo.strPage.value;
	var inargs=new Array(m_strUrl, m_strAPO, m_strPage,document.all.txtCurrentPage.value);

	var strHeight = "230";
	if(g_fIsSP2)
		strHeight = "250";
	var returnval = window.showModalDialog("Print.htm",inargs,"dialogHeight:" + strHeight + "px;dialogWidth:300px;center:yes;resizable:no;help:no;status:no;scroll:no");
	if(returnval != null)
	{
		var strSelect = returnval[0];
		var strStartPageNumber = returnval[1];
		var strPrintPages = returnval[2];
		if(strStartPageNumber <= 0)
			strStartPageNumber = "1";
		if(strPrintPages <= 0)
			strPrintPages = "1";
			
//alert(strStartPageNumber);
		
		switch(strSelect)
		{
			case '1':
				strStartPageNumber = CreateUrl('1');
				strPrintPages = document.PatentInfo.strPage.value;
				break;
			case '2':
				//strStartPageNumber = document.PatentInfo.strUrl.value;
				strStartPageNumber = CreateUrl(strStartPageNumber);
				break;
			case '3':
				strStartPageNumber = CreateUrl(strStartPageNumber);
				break;
		}
		//alert("strStartPageNumber:"+strStartPageNumber);
		//alert("strPrintPages:"+strPrintPages);
		//alert("parent.window.PatentInfo.strAPO.value:"+parent.window.PatentInfo.strAPO.value);
		window.parent.mainFrame.rightFrame.document.all.PatTifAcTiveX1.CtlPrintPageAndNumSet(strStartPageNumber, strPrintPages, document.PatentInfo.strAPO.value);
	}
}

function Download()
{
	var m_strUrl = document.PatentInfo.strUrl.value;
	//var m_strPage = document.PatentInfo.strPage.value;
	var m_strPage = document.all.lbCountPage.innerText;
//alert(m_strPage);
	var m_strAPO = document.PatentInfo.strAPO.value;
	var inargs=new Array(m_strUrl, m_strPage, m_strAPO);

	var strHeight = "210";
	if(g_fIsSP2)
		strHeight = "230";
	var returnval = window.showModalDialog("Download.htm",inargs,"dialogHeight:" + strHeight + "px;dialogWidth:360px;center:yes;resizable:no;help:no;status:no;scroll:no");

	if(returnval != null)
	{
		var r_strAPO = returnval[0];
		var r_strUrl = returnval[1];
		var r_strPage = returnval[2];
		var r_strSavePath = returnval[3];
		document.PatentInfo.strAPO.value = r_strAPO;
		document.PatentInfo.strUrl.value = r_strUrl;
		document.PatentInfo.strPage.value = r_strPage;
		document.PatentInfo.strSavePath.value = r_strSavePath;

		//生成一个随机数的窗口名称
		var theDate =new Date();
		var random=theDate.getTime();
		
		rwin = window.open("../../../documentDownload.do?method=documentDownload",random,"toolbar=no,titlebar=no,location=no,status=no,menubar=no,resizable=no,scrollbars=no,left=0,width=500,height=330");
		if(rwin == null)
		{
			rwin = window.open("../../../documentDownload.do?method=documentDownload",random,"toolbar=no,titlebar=no,location=no,status=no,menubar=no,resizable=no,scrollbars=no,left=0,width=500,height=330");
		}

		
//		window.parent.mainFrame.document.all.PatTifAcTiveX1.CtlPrintPageAndNumSet(strStartPageNumber,strPrintPages);
	}
}

/*
function Download()
{
				getXmlRequest();
                if(!xmlRequest){
                    return ;
                }
                var url = "/cniprBZ/downloadlimit.do?method=getDownLoadTifMaxCount";
                xmlRequest.onreadystatechange = getResult;
                xmlRequest.open("GET", url, true);
                xmlRequest.send(null);
	
	
}
*/

function OnPageMemberkeyDown()
{
	if(event.keyCode == 13)
	{
		MoveTo();
	}
}
function DocumentLoaded()
{
	//document.all.txtCurrentPage.value = "1";
	//alert(parent.window.PatentInfo.strCurPage.value);
	if(parent.window.PatentInfo.strCurPage.value!="null" && parent.window.PatentInfo.strCurPage.value!="")
	{	document.all.txtCurrentPage.value = parent.window.PatentInfo.strCurPage.value;}
	else 
	{	document.all.txtCurrentPage.value = "1"; }
	
	var maindoc = window.parent.document;
	var cPage = 1;
	maindoc.title=maindoc.PatentInfo.strAPO.value+"-"+maindoc.PatentInfo.strTI.value;
	var bktitle = maindoc.PatentInfo.strTI.value;
	var bkauthor = maindoc.PatentInfo.strAPO.value;
	if(bktitle.length>0)
	{
		if(bkauthor.length>0)
			bktitle = bktitle+" - "+bkauthor;
	}
	document.all.lblbkinfo.title = bktitle;
//	if(bktitle.length>36)
//	{
//		bktitle = bktitle.substring(0,35)+"...";
//	}
//	document.all.lblbkinfo.innerText = bktitle;
	document.all.lbCountPage.innerText = window.parent.document.PatentInfo.strPage.value;
	document.all.lbCurrentPage.innerText = document.all.txtCurrentPage.value;
	
	window.onresize = windowresied;
	windowresied();	
	browserVersion();
}

function windowresied()
{
	if(document.body.clientWidth > 850)
	{
		tblTop.width = "100%";
//		tblBottom.width = "100%";
//		window.parent.frames.fsMain.rows="83,*";
	}
	else
	{
//		tblTop.width = "850";
//		tblBottom.width = "850";
//		window.parent.frames.fsMain.rows="100,*";
	}

}

			var xmlRequest = false;
            function getXmlRequest(){
                try{
                    xmlRequest = new XMLHttpRequest();
                }catch(e){
                    xmlRequest = new ActiveXObject("Microsoft.XMLHTTP");
                }
            }
            
            function loading(){
            /*
                getXmlRequest();
                if(!xmlRequest){
                    return ;
                }
                var url = "/cniprBZ/downloadlimit.do?method=getDownLoadTifMaxCount";
                xmlRequest.onreadystatechange = getResult;
                xmlRequest.open("GET", url, true);
                xmlRequest.send(null);
             */   
            }
            function getResult(){
                
                if(xmlRequest.readyState == 4){
                    if(xmlRequest.status == 200){
                        
                        var response = xmlRequest.responseText;
                        //alert(response);
                        if (response<=0) 
                        {
                        	alert("已超过允许下载的最大数。");
                        	
                        } else
                        {
						    var m_strUrl = document.PatentInfo.strUrl.value;
							//var m_strPage = document.PatentInfo.strPage.value;
							var m_strPage = document.all.lbCountPage.innerText;
						//alert(m_strPage);
							var m_strAPO = document.PatentInfo.strAPO.value;
							var inargs=new Array(m_strUrl, m_strPage, m_strAPO);
						
							var strHeight = "210";
							if(g_fIsSP2)
								strHeight = "230";
							var returnval = window.showModalDialog("Download.htm",inargs,"dialogHeight:" + strHeight + "px;dialogWidth:360px;center:yes;resizable:no;help:no;status:no;scroll:no");
						
							if(returnval != null)
							{
								var r_strAPO = returnval[0];
								var r_strUrl = returnval[1];
								var r_strPage = returnval[2];
								var r_strSavePath = returnval[3];
								document.PatentInfo.strAPO.value = r_strAPO;
								document.PatentInfo.strUrl.value = r_strUrl;
								document.PatentInfo.strPage.value = r_strPage;
								document.PatentInfo.strSavePath.value = r_strSavePath;
						
								//生成一个随机数的窗口名称
								var theDate =new Date();
								var random=theDate.getTime();
								
								rwin = window.open("../../../documentDownload.do?method=documentDownload",random,"toolbar=no,titlebar=no,location=no,status=no,menubar=no,resizable=no,scrollbars=no,left=0,width=500,height=330");
								if(rwin == null)
								{
									rwin = window.open("../../../documentDownload.do?method=documentDownload",random,"toolbar=no,titlebar=no,location=no,status=no,menubar=no,resizable=no,scrollbars=no,left=0,width=500,height=330");
								}
						
								
						//		window.parent.mainFrame.document.all.PatTifAcTiveX1.CtlPrintPageAndNumSet(strStartPageNumber,strPrintPages);
							}
                        }
                        
                    }
                }
            }

-->
</script>
</head>

<form name="PatentInfo">
<Script language="JavaScript">
	document.write("<input type=hidden name=strUrl value='"+window.parent.document.PatentInfo.strUrl.value+"'>");
	document.write("<input type=hidden name=strAPO value='"+window.parent.document.PatentInfo.strAPO.value+"'>");
	document.write("<input type=hidden name=strTI value='"+window.parent.document.PatentInfo.strTI.value+"'>");
	document.write("<input type=hidden name=strIPC value='"+window.parent.document.PatentInfo.strIPC.value+"'>");
	document.write("<input type=hidden name=strANN value='"+window.parent.document.PatentInfo.strANN.value+"'>");
	document.write("<input type=hidden name=strPage value='"+window.parent.document.PatentInfo.strPage.value+"'>");
	document.write("<input type=hidden name=strSavePath value=''>");
</Script>
</form>
<body onload="DocumentLoaded()" bgcolor="#ECE9D8">
	  <table id="tblTop" border="0" cellspacing="0" cellpadding="0" width="100%">
  		<tr>
    		<td nowrap>
				<select name="selZoomRate" size="1" onchange="Zoom(this.value);">
					<option value="-1">--缩放--</option>
					<option value="0.1">10%</option>
					<option value="0.2">20%</option>
					<option value="0.3">30%</option>
					<option value="0.4">40%</option>
					<option value="0.5">50%</option>
					<option value="0.6">60%</option>
					<option value="0.7">70%</option>
					<option value="0.8">80%</option>
					<option value="0.9">90%</option>
					<option value="1">100%</option>
				</select>
			</td>
    		<td nowrap width="30" align="center">
			<img src="../../../images/rotaryleft1.gif" onclick="javascript:Rotary();" style="cursor:hand"></td>
    		<td nowrap class="style4"><input type=button value="上一页" onclick="prevpage()" id="btnPrev"><input type=button value="下一页" onclick="nextpage()" id="btnNext">
    		<input name="txtCurrentPage" type=text size=3 onKeyDown="OnPageMemberkeyDown()">
    		<input type=button value="转到" onClick="MoveTo()">
    		&nbsp;说明书共<B><label id="lbCountPage" class="style4"></label></B>页，当前为第<B><label id="lbCurrentPage" class="style4"></label></B>页
  		&nbsp;
  		<!-- 
  		<input type=button value=" 打印 " onclick="Print()" id="btnPrint">
  		 -->
  		&nbsp;<input type=button value=" 下载 " onclick="Download()" id="btnDownload">
  		
  		&nbsp;<input type=button value=" 刷新 " onclick="Refresh()" id="btnRefresh"></td>
  		<td nowrap align="right">&nbsp;
  		<input type=button value="关闭窗口" onclick="javascript:parent.CloseWin();"><label id="lblbkinfo" class="style4"></label></td>
  		</tr>
   	    </table>


</body>

</html>
<Script Language="JavaScript">
//CheckButtonStatus();
//SetReadUrl(document.PatentInfo.strUrl.value, document.PatentInfo.strAPO.value);
</Script>
<input type="hidden" id="btnCheck" onClick="javascript:CheckButtonStatus();">
